<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h2 class="text-primary mb-4">Book Details</h2>

    <div class="card p-4">
        <h4>{{ book.title }}</h4>
        <p><strong>Author:</strong> {{ book.author }}</p>
        <p><strong>Genre:</strong> {{ book.genre }}</p>
        <p><strong>ISBN:</strong> {{ book.isbn }}</p>
        <p><strong>Location:</strong> {{ book.location }}</p>
        <p><strong>Status:</strong> {{ book.status }}</p>
        <p><strong>Borrowed By:</strong> {{ book.borrowed_by_username or "N/A" }}</p>
        <p><strong>Due Date:</strong> {{ book.due_date or "N/A" }}</p>
        <p><strong>Penalty:</strong> ${{ book.penalty }}</p>

        {% if book.status == "Taken" and book.borrowed_by == session["user_id"] %}
        <form method="POST" action="{{ url_for('return_book_route', book_id=book.id) }}">
            <button type="submit" class="btn btn-warning">Return Book</button>
        </form>
        {% endif %}

        {% if session.get("role") in ["admin", "librarian"] %}
        <form method="POST" action="{{ url_for('update_location', book_id=book.id) }}">
            <div class="mb-3">
                <label for="location" class="form-label">Update Location</label>
                <input type="text" id="location" name="location" class="form-control" value="{{ book.location }}" required>
            </div>
            <button type="submit" class="btn btn-primary">Update Location</button>
        </form>
        {% endif %}
    </div>

    <h4 class="mt-5">Borrowing History</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>User</th>
                <th>Borrowed At</th>
                <th>Returned At</th>
                <th>Penalty</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in history %}
            <tr>
                <td>{{ entry.username }}</td>
                <td>{{ entry.borrowed_at }}</td>
                <td>{{ entry.returned_at or "Not Returned" }}</td>
                <td>${{ entry.penalty }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{{ url_for('home') }}" class="btn btn-secondary mt-3">Back to Home</a>
</body>
</html>